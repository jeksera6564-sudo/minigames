<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Crystal Merge</title>

<!-- üî∏ –ó–ê–ì–õ–£–®–ö–ê –Ø–ù–î–ï–ö–° SDK (–¥–ª—è –Ø–Ω–¥–µ–∫—Å –ò–≥—Ä) -->
<!--
<script src="https://yandex.ru/games/sdk/v2"></script>
<script>
YaGames.init().then(ysdk => {
  window.ysdk = ysdk;
});
</script>
-->

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:radial-gradient(circle at top,#1b1f3a,#090b18);
  color:#fff;
  display:flex;
  flex-direction:column;
  align-items:center;
}

h1{margin:8px}

#stats{
  display:flex;
  gap:15px;
  margin-bottom:6px;
  font-size:16px;
}

#level{
  margin-bottom:10px;
  font-weight:bold;
}

#board{
  display:grid;
  grid-template-columns:repeat(5,72px);
  gap:10px;
}

.cell{
  width:72px;
  height:72px;
  background:#20244a;
  border-radius:18px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:30px;
  cursor:pointer;
  transition:0.25s;
  box-shadow:0 0 12px rgba(0,0,0,0.5);
}

.cell:hover{transform:scale(1.06)}
.cell.selected{outline:3px solid gold}

.merge{animation:merge 0.4s ease}
@keyframes merge{
  0%{transform:scale(1)}
  50%{transform:scale(1.5)}
  100%{transform:scale(1)}
}

.rare{box-shadow:0 0 15px 4px rgba(0,255,255,0.7)}
.legendary{
  box-shadow:0 0 25px 8px rgba(255,215,0,0.9);
  animation:pulse 1.5s infinite;
}
@keyframes pulse{
  0%{transform:scale(1)}
  50%{transform:scale(1.1)}
  100%{transform:scale(1)}
}

button{
  margin-top:10px;
  padding:10px 18px;
  border:none;
  border-radius:12px;
  background:#4cafef;
  color:#000;
  font-weight:bold;
  cursor:pointer;
}
button:disabled{opacity:0.5}
</style>
</head>

<body>

<h1>üíé Crystal Merge</h1>

<div id="stats">
  <div>ü™ô <span id="coins">0</span></div>
  <div>‚ö° <span id="boosts">0</span></div>
</div>

<div id="level">–£—Ä–æ–≤–µ–Ω—å: <span id="lvl">1</span> | –¶–µ–ª—å: <span id="goal">100</span> –º–æ–Ω–µ—Ç</div>

<div id="board"></div>

<button id="shuffleBtn">üîÄ –ü–µ—Ä–µ–º–µ—à–∞—Ç—å (1 –±—É—Å—Ç)</button>

<script>
const size=5;
const board=document.getElementById("board");
const coinsEl=document.getElementById("coins");
const boostsEl=document.getElementById("boosts");
const lvlEl=document.getElementById("lvl");
const goalEl=document.getElementById("goal");

const crystals=[
  {emoji:"üíé", type:"normal"},
  {emoji:"üî∑", type:"normal"},
  {emoji:"üîÆ", type:"normal"},
  {emoji:"üí†", type:"rare"},
  {emoji:"üü£", type:"rare"},
  {emoji:"üëë", type:"legendary"}
];

let cells=[], coins=0, boosts=0, level=1, selected=null;

function goalForLevel(lvl){
  return 100 + lvl*80;
}

function save(){
  localStorage.setItem("crystalSave",JSON.stringify({
    cells,coins,boosts,level
  }));
}

function load(){
  const d=localStorage.getItem("crystalSave");
  if(d){
    const s=JSON.parse(d);
    cells=s.cells;
    coins=s.coins;
    boosts=s.boosts;
    level=s.level;
  }else init();
}

function randomCrystal(){
  let r=Math.random();
  if(r<0.02) return {level:5};     // –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π
  if(r<0.12) return {level:3};     // —Ä–µ–¥–∫–∏–π
  return {level:0};
}

function init(){
  cells=[];
  for(let i=0;i<size*size;i++) cells.push(randomCrystal());
  coins=0; boosts=0; level=1;
  save();
}

function render(){
  board.innerHTML="";
  cells.forEach((c,i)=>{
    const div=document.createElement("div");
    div.className="cell";
    const data=crystals[c.level]||crystals[0];
    div.textContent=data.emoji;
    if(data.type==="rare") div.classList.add("rare");
    if(data.type==="legendary") div.classList.add("legendary");
    if(selected===i) div.classList.add("selected");
    div.onclick=()=>clickCell(i);
    board.appendChild(div);
  });
  coinsEl.textContent=coins;
  boostsEl.textContent=boosts;
  lvlEl.textContent=level;
  goalEl.textContent=goalForLevel(level);
}

function clickCell(i){
  if(selected===null){selected=i;}
  else{
    if(isNeighbor(selected,i)) merge(selected,i);
    selected=null;
  }
  render();
}

function isNeighbor(a,b){
  const ax=a%size, ay=Math.floor(a/size);
  const bx=b%size, by=Math.floor(b/size);
  return Math.abs(ax-bx)+Math.abs(ay-by)===1;
}

function merge(a,b){
  if(cells[a].level===cells[b].level){
    cells[b].level++;
    cells[a]=randomCrystal();

    let gain=10*cells[b].level;
    if(cells[b].level>=5) gain*=5; // –ª–µ–≥–µ–Ω–¥–∞—Ä–Ω—ã–π –±–æ–Ω—É—Å
    coins+=gain;

    if(Math.random()<0.35) boosts++;

    const el=board.children[b];
    el.classList.add("merge");
    setTimeout(()=>el.classList.remove("merge"),400);

    checkLevel();
    save();
  }
}

function checkLevel(){
  if(coins>=goalForLevel(level)){
    level++;
    boosts+=2;

    // üî∏ –ú–ï–°–¢–û –î–õ–Ø –ü–û–ö–ê–ó–ê –†–ï–ö–õ–ê–ú–´ –Ø–ù–î–ï–ö–°
    /*
    ysdk.adv.showFullscreenAdv();
    */
  }
}

document.getElementById("shuffleBtn").onclick=()=>{
  if(boosts<=0) return;
  boosts--;
  cells.sort(()=>Math.random()-0.5);
  save();
  render();
};

load();
render();
</script>

</body>
</html>
